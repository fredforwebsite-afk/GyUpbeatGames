<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Team Buzzer</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Select Team -->
  <div class="container" id="teamSelect">
    <h1>Select Your Team</h1>
    <button class="team-choice" onclick="selectTeam('Zack')">Team Zack</button>
    <button class="team-choice" onclick="selectTeam('Ryan')">Team Ryan</button>
    <button class="team-choice" onclick="selectTeam('Kyle')">Team Kyle</button>
  </div>

  <!-- Buzzer Area -->
  <div class="container" id="buzzerArea" style="display:none;">
    <h2 id="teamName"></h2>
    <button id="buzzerBtn" class="buzzer" disabled>Press Buzzer!</button>
  </div>

  <!-- Answer Box -->
  <div class="container" id="answerArea" style="display:none;">
    <h2>Type your answer:</h2>
    <input type="text" id="teamAnswer" placeholder="Your final answer...">
    <button onclick="submitAnswer()">Submit</button>
    <div id="answerTimer" style="font-size:22px;margin-top:10px;color:lightgreen;">Answer Time: 0</div>
  </div>

  <!-- Sounds -->
  <audio id="buzzSound" src="sound/buzzSound.mp3"></audio>
  <audio id="correctSound" src="sound/correctSound.wav"></audio>
  <audio id="wrongSound" src="sound/wrongSound.wav"></audio>

  <!-- Firebase + Game Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, get, child, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // ✅ Replace with your Firebase config
    const firebaseConfig = {
  apiKey: "AIzaSyADxgFTvu0iyYC_ano36TfClPsH4YfqzE",
  authDomain: "gygames-fafcb.firebaseapp.com",
  databaseURL: "https://gygames-fafcb-default-rtdb.firebaseio.com/",
  projectId: "gygames-fafcb",
  storageBucket: "gygames-fafcb.firebasestorage.app",
  messagingSenderId: "603231637988",
  appId: "1:603231637988:web:31ac4e91fcd58935ffb7f1",
  measurementId: "G-058J8NLC43"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let teamName = null;
    let answerInterval;
    let answerTimer = 20;

    // ---- Team Select ----
    function selectTeam(name) {
      teamName = name;

      document.getElementById("teamSelect").style.display = "none";
      document.getElementById("buzzerArea").style.display = "block";
      document.getElementById("teamName").innerText = "You are Team " + teamName;
    }
    window.selectTeam = selectTeam;

    // ---- Buzzer Availability ----
    onValue(ref(db, "enableBuzzer"), (snap) => {
      const enable = snap.exists() ? snap.val() === true : false;

      onValue(ref(db, "stealMode"), (stealSnap) => {
        const steal = stealSnap.exists() ? stealSnap.val() : null;

        onValue(ref(db, "buzzed"), (buzzSnap) => {
          const alreadyBuzzed = buzzSnap.exists() ? buzzSnap.val() : null;

          if (teamName) {
            if ((enable && !alreadyBuzzed) || (steal && steal !== teamName && !alreadyBuzzed)) {
              document.getElementById("buzzerBtn").disabled = false;
            } else {
              document.getElementById("buzzerBtn").disabled = true;
            }
          }
        });
      });
    });

    // ---- Buzz Button ----
    document.getElementById("buzzerBtn").onclick = async () => {
      if (!teamName) return;

      await set(ref(db, "buzzed"), teamName);
      document.getElementById("buzzerBtn").disabled = true;
      document.getElementById("answerArea").style.display = "block";

      startAnswerTimer();
      document.getElementById("buzzSound").play();
    };

    // ---- Answer Timer ----
    function startAnswerTimer() {
      clearInterval(answerInterval);
      answerTimer = 20;
      document.getElementById("answerTimer").innerText = "Answer Time: " + answerTimer;

      answerInterval = setInterval(() => {
        answerTimer--;
        document.getElementById("answerTimer").innerText = "Answer Time: " + answerTimer;
        if (answerTimer <= 0) {
          clearInterval(answerInterval);
          document.getElementById("answerTimer").innerText = "⏳ Time's up!";
          document.getElementById("answerArea").style.display = "none";
        }
      }, 1000);
    }

    // ---- Submit Answer ----
    async function submitAnswer() {
      let ans = document.getElementById("teamAnswer").value;
      if (ans.trim() === "") return;

      await set(ref(db, "teamAnswers/" + teamName), ans);
      await set(ref(db, "submittedAnswer"), teamName + ": " + ans);

      document.getElementById("answerArea").style.display = "none";
      clearInterval(answerInterval);
    }
    window.submitAnswer = submitAnswer;
  </script>
</body>

</html>

